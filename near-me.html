<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OnlyFans Nearby: Find & Connect With Local Creators | FansPedia</title>
  <meta name="description" content="Discover nearby OnlyFans creators based on your location. Browse and connect with local talent on FansPedia." />
  <link rel="canonical" href="https://fanspedia.net/near-me/" />
  <link rel="icon" type="image/svg+xml" sizes="any" href="/favicon.svg" />
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YV9QD82K7G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-YV9QD82K7G', { 'anonymize_ip': true, 'debug_mode': true });
    // Fallback visibility ping after load
    window.addEventListener('load', () => {
      if (typeof gtag === 'function') {
        gtag('event', 'page_visible', { page_path: location.pathname });
        console.log('[GA4] page_visible sent');
      } else {
        console.warn('[GA4] gtag not available');
      }
    });
  </script>

  <!-- Vercel Analytics -->
  <script type="module">
    import { inject } from '@vercel/analytics';
    inject();
  </script>

  <link rel="preconnect" href="https://images.weserv.nl" crossorigin>
  <link rel="preconnect" href="https://nominatim.openstreetmap.org" crossorigin>
  <link rel="preconnect" href="https://ipapi.co" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <!-- Preload Bootstrap grid CSS (needed for col-* responsive card layout) -->
  <link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"></noscript>
  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
  <style>
    :root {
      --bg-primary: #f5f5f7;
      --bg-secondary: #ffffff;
      --text-primary: #1d1d1f;
      --text-secondary: #666;
      --text-muted: #888;
      --border-color: #e0e0e0;
      --card-shadow: rgba(0, 0, 0, 0.08);
      --card-shadow-hover: rgba(0, 0, 0, 0.12);
      --input-bg: #ffffff;
      --chip-bg: #ffffff;
      --chip-border: #e7eef6;
      --chip-hover-bg: #007aff;
      --chip-hover-text: #ffffff;
      --brand-color: #0099D6;
      --placeholder-color: #999;
      --heading-color: #1d1d1f;
      --brand:#00AFF0;
      --brand-d:#0099D6;
      --border:#d9e3eb;
    }
    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2a2a2a;
      --text-primary: #e8e8e8;
      --text-secondary: #c8c8c8;
      --text-muted: #888;
      --border-color: #404040;
      --card-shadow: rgba(0, 0, 0, 0.3);
      --card-shadow-hover: rgba(0, 0, 0, 0.5);
      --input-bg: #2a2a2a;
      --chip-bg: #2a2a2a;
      --chip-border: #404040;
      --chip-hover-bg: #00AFF0;
      --chip-hover-text: #ffffff;
      --brand-color: #00AFF0;
      --placeholder-color: #888;
      --heading-color: #e8e8e8;
      --border:#2e3a42;
    }
    body { margin:0; padding-top:70px; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,sans-serif; background:var(--bg-primary); color:var(--text-primary); }
    
    /* SUPERIOR STICKY HEADER */
    .superior-header { position:fixed; top:0; left:0; right:0; z-index:9999; background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); box-shadow:0 4px 24px rgba(0,175,240,0.25); transition:all .3s cubic-bezier(0.4,0,0.2,1); }
    .superior-header.scrolled { box-shadow:0 8px 32px rgba(0,175,240,0.35); }
    .header-main { padding:10px 0; backdrop-filter:blur(10px); }
    .header-container { max-width:1400px; margin:0 auto; padding:0 16px; display:flex; align-items:center; justify-content:space-between; gap:16px; }
    .logo-section { display:flex; align-items:center; gap:12px; flex-shrink:0; text-decoration:none; }
    .logo-icon { width:40px; height:40px; background:#fff; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px; box-shadow:0 4px 12px rgba(0,0,0,0.15); transition:transform .3s ease; }
    .logo-icon:hover { transform:scale(1.05) rotate(5deg); }
    .logo-icon i { color:#00AFF0; }
    .logo-text { display:flex; flex-direction:column; }
    .logo-text .brand { font-size:22px; font-weight:900; color:#fff; letter-spacing:.3px; line-height:1; text-shadow:0 2px 4px rgba(0,0,0,0.3),0 1px 2px rgba(0,0,0,0.2); filter:brightness(1.05); }
    .logo-text .tagline { font-size:11px; color:rgba(255,255,255,0.95); font-weight:600; letter-spacing:.8px; margin-top:2px; text-shadow:0 1px 3px rgba(0,0,0,0.2); }
    .header-search-section { flex:1; max-width:560px; position:relative; }
    .header-search-wrapper { position:relative; display:flex; align-items:center; }
    .header-search-input { width:100%; padding:10px 16px 10px 44px; border:2px solid rgba(255,255,255,0.3); border-radius:50px; background:rgba(255,255,255,0.95); font-size:15px; font-weight:500; color:#1d1d1f; transition:all .3s ease; box-shadow:0 4px 16px rgba(0,0,0,0.1); }
    .header-search-input:focus { outline:none; border-color:#fff; background:#fff; box-shadow:0 8px 32px rgba(0,0,0,0.15); transform:translateY(-1px); }
    .header-search-input::placeholder { color:var(--placeholder-color); }
    .header-search-icon { position:absolute; left:16px; color:#00AFF0; font-size:18px; pointer-events:none; }
    .header-actions { display:flex; align-items:center; gap:12px; flex-shrink:0; }
    .theme-toggle,.safe-search-toggle { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:#fff; width:44px; height:44px; border-radius:12px; cursor:pointer; transition:all .3s ease; display:inline-flex; align-items:center; justify-content:center; font-size:20px; }
    .theme-toggle:hover,.safe-search-toggle:hover { background:rgba(255,255,255,0.3); transform:translateY(-1px); }
    .safe-search-toggle.active { background:rgba(52,199,89,0.9); border-color:rgba(52,199,89,1); box-shadow:0 0 20px rgba(52,199,89,0.4); }
    .safe-search-toggle.active::after { content:''; position:absolute; top:2px; right:2px; width:10px; height:10px; background:#34c759; border:2px solid #fff; border-radius:50%; box-shadow:0 2px 8px rgba(52,199,89,0.6); }
    .lang-toggle { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:white; width:44px; height:44px; border-radius:12px; cursor:pointer; transition:all 0.3s ease; display:inline-flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; position:relative; z-index:100; flex-shrink:0; }
    .lang-toggle #langIndicator { pointer-events:none; display:block; }
    .lang-toggle:hover { background:rgba(255,255,255,0.3); transform:translateY(-1px); }
    .lang-toggle:active { transform:translateY(0); }
    .mobile-menu-toggle { display:none; background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:#fff; width:44px; height:44px; border-radius:12px; cursor:pointer; transition:all .3s ease; justify-content:center; align-items:center; font-size:18px; }
    .mobile-menu-toggle:hover { background:rgba(255,255,255,0.3); transform:translateY(-1px); }
    .desktop-nav { position:relative; flex-shrink:0; }
    .desktop-nav .nav-btn { display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.35); border-radius:9999px; padding:10px 14px; font-weight:800; font-size:14px; cursor:pointer; transition:all .2s ease; text-decoration:none; }
    .desktop-nav .nav-btn:hover { background:rgba(255,255,255,0.3); }
    .desktop-nav .nav-btn i { font-size:12px; opacity:0.9; }
    .desktop-nav .dropdown-menu { position:absolute; right:0; top:calc(100% + 8px); background:#fff; border-radius:12px; box-shadow:0 12px 32px rgba(0,0,0,0.15); padding:8px; min-width:240px; display:none; z-index:10000; }
    .desktop-nav .dropdown-menu.open { display:block; }
    .desktop-nav .dropdown-menu a { display:block; padding:10px 12px; color:#1d1d1f; font-weight:700; border-radius:8px; text-decoration:none; transition:background .15s ease,color .15s ease; }
    .desktop-nav .dropdown-menu a:hover { background:#f5f5f7; color:#00AFF0; }
    .desktop-nav .dropdown-menu .divider { height:1px; background:#eee; margin:6px 6px; }
    .desktop-nav .dropdown-menu a.view-all { color:#00AFF0; }
    .drawer-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:10000; opacity:0; pointer-events:none; transition:opacity .3s ease; }
    .drawer-overlay.open { opacity:1; pointer-events:auto; }
    .mobile-drawer { position:fixed; top:0; right:-100%; width:82%; max-width:340px; height:100%; background:#fff; box-shadow:-8px 0 24px rgba(0,0,0,0.2); z-index:10001; padding:16px; display:flex; flex-direction:column; gap:6px; transition:right .3s ease; }
    .mobile-drawer.open { right:0; }
    .mobile-drawer .drawer-close { align-self:flex-end; background:none; border:none; font-size:28px; line-height:1; color:#1d1d1f; margin-bottom:4px; cursor:pointer; }
    .mobile-drawer > a { display:block; padding:14px 12px; border-radius:8px; color:#1d1d1f; font-weight:700; text-decoration:none; margin:2px 0; font-size:16px; }
    .mobile-drawer > a:hover { background:#f5f5f7; color:#00AFF0; }
    .drawer-categories-toggle { display:flex; align-items:center; justify-content:space-between; padding:14px 12px; cursor:pointer; border-radius:8px; margin:2px 0; transition:background .2s ease; font-size:16px; font-weight:700; color:#1d1d1f; }
    .drawer-categories-toggle:hover { background:#f5f5f7; }
    .drawer-categories-toggle .icon-text { display:flex; align-items:center; gap:10px; }
    .drawer-categories-toggle .icon-text i { font-size:18px; color:#1d1d1f; }
    .drawer-categories-toggle .chevron { font-size:14px; transition:transform .3s ease; color:#666; }
    .drawer-categories-toggle.open .chevron { transform:rotate(180deg); }
    #drawerCategoriesSection { max-height:0; overflow:hidden; transition:max-height .3s ease,opacity .3s ease; opacity:0; }
    #drawerCategoriesSection.open { max-height:800px; opacity:1; overflow-y:auto; }
    .drawer-categories-label { color:#999; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.8px; padding:12px 16px 8px; margin:0; }
    #drawerCategories { display:flex; flex-direction:column; gap:0; padding:0 4px; max-height:400px; overflow-y:auto; }
    #drawerCategories a { display:block; padding:12px 12px; color:#555; font-weight:600; text-decoration:none; border-radius:6px; margin:1px 0; font-size:15px; transition:background .15s ease,color .15s ease; }
    #drawerCategories a:hover { background:#f5f5f7; color:#00AFF0; }
    .drawer-view-all-btn { display:block; margin:12px 8px 8px; padding:14px 20px; background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); color:#fff; text-align:center; border-radius:12px; font-weight:800; text-decoration:none; font-size:15px; box-shadow:0 4px 12px rgba(0,175,240,0.3); transition:transform .2s ease,box-shadow .2s ease; }
    .drawer-view-all-btn:hover { transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,175,240,0.4); color:#fff; }
    .mobile-search-modal { position:fixed; inset:0; background:var(--bg-secondary); z-index:10003; display:none; flex-direction:column; color:var(--text-primary); }
    .mobile-search-modal.active { display:flex; }
    .mobile-search-header { display:flex; align-items:center; gap:12px; padding:16px; background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); box-shadow:0 4px 12px rgba(0,175,240,0.3); }
    .mobile-search-back { background:none; border:none; color:#fff; font-size:24px; cursor:pointer; padding:8px; display:flex; align-items:center; justify-content:center; }
    .mobile-search-input-wrapper { flex:1; position:relative; }
    .mobile-search-input { width:100%; padding:12px 16px 12px 44px; border:2px solid var(--border-color); border-radius:50px; background:var(--input-bg); font-size:16px; font-weight:500; color:var(--text-primary); transition:background .25s ease,border-color .25s ease,box-shadow .25s ease; }
    .mobile-search-input:focus { outline:none; border-color:var(--brand-color); background:var(--bg-secondary); box-shadow:0 0 0 3px rgba(0,175,240,0.25); }
    .mobile-search-icon { position:absolute; left:16px; top:50%; transform:translateY(-50%); color:#00AFF0; font-size:18px; pointer-events:none; }
    .mobile-search-content { flex:1; overflow-y:auto; padding:20px 16px; }
    .mobile-search-label { color:var(--text-secondary); font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.8px; margin-bottom:12px; }
    .mobile-search-suggestions { display:flex; flex-direction:column; gap:4px; }
    .mobile-search-suggestion { display:flex; align-items:center; gap:12px; padding:14px 16px; background:var(--bg-primary); border-radius:12px; text-decoration:none; color:var(--text-primary); font-weight:600; font-size:15px; transition:all .2s ease; }
    .mobile-search-suggestion:hover,.mobile-search-suggestion:active { background:var(--bg-secondary); transform:translateX(4px); }
    .mobile-search-suggestion i { color:#00AFF0; font-size:16px; }
    .mobile-search-trigger { display:none; background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:#fff; width:44px; height:44px; border-radius:12px; cursor:pointer; justify-content:center; align-items:center; font-size:20px; transition:all .3s ease; }
    .mobile-search-trigger:hover { background:rgba(255,255,255,0.3); transform:translateY(-1px); }
    .safe-search-modal { position:fixed; inset:0; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); z-index:10002; display:none; align-items:center; justify-content:center; padding:20px; animation:fadeIn .3s ease; }
    .safe-search-modal.show { display:flex; }
    @keyframes fadeIn { from{opacity:0;}to{opacity:1;} }
    .safe-search-modal-content { background:var(--bg-secondary); border-radius:24px; padding:40px; max-width:520px; width:100%; box-shadow:0 20px 60px rgba(0,0,0,0.3); animation:slideUp .3s cubic-bezier(0.4,0,0.2,1); position:relative; }
    @keyframes slideUp { from{transform:translateY(40px);opacity:0;}to{transform:translateY(0);opacity:1;} }
    .safe-search-modal-icon { width:80px; height:80px; background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); border-radius:20px; display:flex; align-items:center; justify-content:center; margin:0 auto 24px; font-size:36px; color:#fff; box-shadow:0 8px 24px rgba(0,175,240,0.4); }
    .safe-search-modal h2 { font-size:28px; font-weight:800; color:var(--text-primary); margin-bottom:12px; text-align:center; }
    .safe-search-modal p { color:var(--text-secondary); font-size:16px; line-height:1.6; text-align:center; margin-bottom:32px; }
    .safe-search-modal-actions { display:flex; gap:12px; flex-direction:column; }
    .safe-search-modal-btn { padding:16px 32px; border-radius:12px; font-weight:700; font-size:16px; cursor:pointer; transition:all .3s ease; border:none; text-align:center; }
    .safe-search-modal-btn-primary { background:linear-gradient(135deg,#34c759 0%,#30b350 100%); color:#fff; box-shadow:0 6px 18px rgba(52,199,89,0.4); }
    .safe-search-modal-btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(52,199,89,0.5); }
    .safe-search-modal-btn-secondary { background:var(--bg-primary); color:var(--text-primary); border:2px solid var(--border-color); }
    .safe-search-modal-btn-secondary:hover { background:var(--bg-secondary); border-color:var(--text-secondary); }
    .safe-search-modal-footer { margin-top:24px; text-align:center; font-size:13px; color:var(--text-muted); }
    @media (max-width:768px) { body{padding-top:66px;} .header-container{flex-wrap:nowrap;gap:12px;} .logo-text .tagline{display:none;} .header-search-section{display:none !important;} .mobile-search-trigger{display:inline-flex;} .desktop-nav{display:none;} .mobile-menu-toggle{display:inline-flex;} .header-main{padding:8px 0;} }
    @media (max-width:480px) { body{padding-top:62px;} .logo-icon{width:40px;height:40px;font-size:20px;} .logo-text .brand{font-size:16px;} .header-main{padding:6px 0;} }
    
    main { max-width:1140px; margin:0 auto; padding:48px 24px 64px; }

    .hero { text-align:center; padding:16px 0 40px; }
    .hero h1 { font-size: clamp(2.2rem,5.5vw,3.4rem); line-height:1.1; margin:0 0 16px; font-weight:800; color:var(--brand-d); }
    .hero h2 { font-size: clamp(1.05rem,2.4vw,1.4rem); font-weight:500; margin:0; color:var(--text-secondary); }

    .location-box { background:var(--bg-secondary); border:1px solid var(--border); border-radius:20px; padding:28px 32px; max-width:640px; margin:32px auto 32px; box-shadow:0 8px 28px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:10px; }
    .location-box-label { font-size:13px; font-weight:600; text-transform:uppercase; letter-spacing:.5px; color:var(--text-secondary); }
    .current-location { display:flex; align-items:center; gap:12px; font-size:18px; font-weight:600; }
    .current-location i { color:var(--brand); }
    .location-actions { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; margin-top:18px; }
    .btn { border:none; cursor:pointer; font-size:16px; font-weight:600; padding:18px 34px; border-radius:14px; display:inline-flex; align-items:center; gap:10px; transition:.25s background,color,box-shadow,transform; }
    .btn-primary { background:var(--brand); color:#fff; box-shadow:0 4px 18px rgba(0,175,240,.35); }
    .btn-primary:hover { background:var(--brand-d); transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,175,240,.4); }
    .btn-outline { background:transparent; color:var(--brand-d); border:2px solid var(--brand); }
    .btn-outline:hover { background:var(--brand); color:#fff; }

    /* Modal */
    .modal-overlay { position:fixed; inset:0; background:rgba(13,29,41,.55); display:none; align-items:flex-start; justify-content:center; padding:60px 20px 40px; z-index:2000; overflow-y:auto; }
    .modal-overlay.open { display:flex; }
    .modal { background:var(--bg-secondary); width:100%; max-width:560px; border-radius:20px; box-shadow:0 12px 40px rgba(0,0,0,.25); border:1px solid var(--border); display:flex; flex-direction:column; }
    .modal-header { padding:20px 24px 16px; background:linear-gradient(135deg,var(--brand) 0%,var(--brand-d) 100%); color:#fff; border-radius:20px 20px 0 0; position:sticky; top:0; }
    .modal-header h3 { margin:0 0 4px; font-size:20px; font-weight:700; }
    .modal-header p { margin:0; font-size:13px; opacity:.9; }
    .modal-close { position:absolute; top:14px; right:16px; background:rgba(255,255,255,.2); border:none; color:#fff; width:34px; height:34px; border-radius:10px; cursor:pointer; font-size:18px; }
    .modal-close:hover { background:rgba(255,255,255,.28); }

    .country-search-wrapper { padding:14px 24px 10px; }
    .country-search { width:100%; padding:14px 16px; font-size:15px; border:1px solid var(--border); border-radius:12px; background:#fff; }
    [data-theme="dark"] .country-search { background:#2b3339; color:var(--text-primary); border-color:#3d4a52; }

    .country-list { list-style:none; margin:0; padding:0 0 10px; }
    .country-item { padding:14px 24px; display:flex; align-items:center; gap:18px; cursor:pointer; border-bottom:1px solid var(--border); font-weight:600; font-size:15px; }
    .country-item:hover { background:#f2f9fc; }
    [data-theme="dark"] .country-item:hover { background:#263036; }
    .country-code { font-size:14px; font-weight:700; color:var(--brand-d); width:34px; }

    .results-section { max-width:1120px; margin:60px auto 0; }
    .results-header { text-align:center; margin-bottom:32px; }
    .results-header h2 { font-size:clamp(1.8rem,4vw,2.4rem); font-weight:700; color:var(--brand-d); margin:0 0 8px; }
    .results-header p { font-size:16px; color:var(--text-secondary); margin:0; }
    .results-placeholder { text-align:center; padding:60px 20px 20px; color:var(--text-secondary); font-size:18px; }
    /* Homepage card styles */
    .card { background:var(--bg-secondary); color:var(--text-primary); border:none; border-radius:20px; transition:.3s ease; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,.08); position:relative; }
    .card:hover { transform:translateY(-4px); box-shadow:0 8px 24px rgba(0,0,0,.12); }
    .card img { border-radius:20px 20px 0 0; height:360px; min-height:360px; object-fit:cover; width:100%; background:linear-gradient(90deg,#e8e8e8 25%,#f0f0f0 50%,#e8e8e8 75%); background-size:200% 100%; animation:shimmer 1.5s infinite; transition:filter .3s ease,opacity .3s ease; }
    @keyframes shimmer { 0%{background-position:200% 0;}100%{background-position:-200% 0;} }
    body.safe-search-active .card img { filter: blur(20px) saturate(0.7); opacity:0.85; }
    body.safe-search-active .card:hover img { filter: blur(8px) saturate(0.85); opacity:0.95; }
    body.safe-search-active .card::before { content:'18+'; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.75); color:#fff; padding:12px 24px; border-radius:12px; font-weight:800; font-size:24px; letter-spacing:2px; pointer-events:none; z-index:5; backdrop-filter:blur(10px); border:2px solid rgba(255,255,255,0.3); }
    .favorite-btn { position:absolute; top:12px; right:12px; background:#fff; border:none; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,.15); transition:.2s ease; z-index:10; font-size:20px; }
    .favorite-btn span { color:#ccc; }
    .favorite-btn:hover { transform:scale(1.1); background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); box-shadow:0 6px 16px rgba(0,175,240,.35); }
    .favorite-btn:hover span { color:#fff !important; }
    .favorite-btn.active { background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); box-shadow:0 6px 16px rgba(0,175,240,.35); }
    .favorite-btn.active span { color:#fff !important; }
    .card-body { padding:20px; }
    .card h5 { font-size:20px; font-weight:700; margin:0 0 4px; color:var(--text-primary); }
    .username { color:var(--text-secondary); font-size:14px; margin:0 0 8px; }
    .price-free { color:#34c759; font-weight:700; font-size:16px; text-transform:uppercase; }
    .price-tag { color:#34c759; font-weight:700; font-size:18px; }
    .bio-snippet { color:var(--text-secondary); font-size:13px; line-height:1.4; margin-top:8px; display:-webkit-box; -webkit-line-clamp:2; line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .view-profile-btn { background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); color:#fff; border:none; padding:14px 28px; border-radius:12px; font-weight:800; font-size:16px; cursor:pointer; text-decoration:none; display:block; width:100%; text-align:center; margin-top:16px; box-shadow:0 6px 18px rgba(0,175,240,.35); transition:.25s ease; }
    .view-profile-btn:hover { background:linear-gradient(135deg,#0099D6 0%,#0088C0 100%); transform:translateY(-1px); box-shadow:0 8px 22px rgba(0,175,240,.45); }
    .load-more-wrapper { text-align:center; margin:34px 0 80px; }
    .load-more-btn { background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%); border:none; color:#fff; font-weight:700; padding:18px 42px; font-size:18px; border-radius:18px; cursor:pointer; box-shadow:0 6px 18px rgba(0,175,240,.35); transition:.25s ease; }
    .load-more-btn:hover { transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,175,240,.45); }
    .load-more-btn:disabled { opacity:.55; cursor:not-allowed; transform:none; }

    .loading-inline { display:inline-flex; align-items:center; gap:6px; font-size:14px; color:var(--text-secondary); }
    .spinner { width:16px; height:16px; border:3px solid var(--border); border-top-color:var(--brand); border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }

    @media (max-width:640px) {
      .location-box { padding:24px 24px; margin:24px auto; }
      .btn { width:100%; justify-content:center; }
      .hero h1 { font-size:2.4rem; }
    }
  </style>
</head>
<body>
  <!-- SUPERIOR STICKY HEADER -->
  <header class="superior-header" id="mainHeader">
    <div class="header-main">
      <div class="header-container">
        <!-- Logo -->
        <a href="/" class="logo-section">
          <svg width="140" height="42" viewBox="0 0 400 120" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(10,8)">
              <path d="M48 4 C31 4 18 17.5 18 34.5 C18 48.5 30.1 62.9 42.4 79.1 C45.0 82.7 51.0 82.7 53.6 79.1 C65.9 62.9 78 48.5 78 34.5 C78 17.5 65 4 48 4 Z" fill="#FFFFFF"/>
              <text x="48" y="40" text-anchor="middle" dominant-baseline="middle" font-family="Poppins, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="34" font-weight="700" fill="#000000">F</text>
            </g>
            <text x="115" y="64" font-family="Poppins, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="40" font-weight="500" fill="#FFFFFF">FansPedia</text>
          </svg>
        </a>
        <!-- Desktop navigation -->
        <div class="desktop-nav">
          <button id="categoriesToggle" class="nav-btn" aria-haspopup="true" aria-expanded="false">Categories <i class="fas fa-chevron-down" aria-hidden="true"></i></button>
          <div id="categoriesMenu" class="dropdown-menu" role="menu" aria-hidden="true"></div>
        </div>

        <div class="desktop-nav">
          <a href="/locations/" class="nav-btn">
            Locations <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
          </a>
        </div>
        <!-- Search -->
        <div class="header-search-section">
          <div class="header-search-wrapper">
            <i class="fas fa-search header-search-icon"></i>
            <input type="text" class="header-search-input" placeholder="Search by name, location, category..." id="headerSearch" autocomplete="off" autocapitalize="none" spellcheck="false">
          </div>
        </div>
        <!-- Actions -->
        <div class="header-actions">
          <button class="mobile-search-trigger" id="mobileSearchTrigger" aria-label="Search"><i class="fas fa-search"></i></button>
          <button class="safe-search-toggle" id="safeSearchToggle" aria-label="Toggle Safe Search (blur images)" title="Safe Search: Browse comfortably in public"><i class="fas fa-eye-slash"></i></button>
          <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>
          <button class="lang-toggle" id="langToggle" onclick="toggleLanguage()"><span id="langIndicator">EN</span></button>
          <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu"><i class="fas fa-bars"></i></button>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Mobile Search Modal -->
  <div class="mobile-search-modal" id="mobileSearchModal">
    <div class="mobile-search-header">
      <button class="mobile-search-back" id="mobileSearchBack" aria-label="Close search"><i class="fas fa-arrow-left"></i></button>
      <div class="mobile-search-input-wrapper">
        <i class="fas fa-search mobile-search-icon"></i>
        <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="Search by name, location, category..." autocomplete="off" autocapitalize="none" spellcheck="false">
      </div>
    </div>
    <div class="mobile-search-content">
      <div class="mobile-search-label">POPULAR SEARCHES</div>
      <div class="mobile-search-suggestions" id="mobileSearchSuggestions"></div>
    </div>
  </div>
  
  <!-- Safe Search Modal -->
  <div id="safeSearchModal" class="safe-search-modal" role="dialog" aria-labelledby="safeSearchModalTitle" aria-modal="true">
    <div class="safe-search-modal-content">
      <div class="safe-search-modal-icon"><i class="fas fa-shield-alt"></i></div>
      <h2 id="safeSearchModalTitle">Browse Safely in Public?</h2>
      <p>Enable <strong>Safe Search</strong> to blur images so you can comfortably browse at work, on the bus, or anywhere public. You can toggle this anytime using the shield icon in the header.</p>
      <div class="safe-search-modal-actions">
        <button class="safe-search-modal-btn safe-search-modal-btn-primary" id="enableSafeSearch"><i class="fas fa-shield-alt"></i> Enable Safe Search</button>
        <button class="safe-search-modal-btn safe-search-modal-btn-secondary" id="dismissSafeSearch">No Thanks, I'm in Private</button>
      </div>
      <div class="safe-search-modal-footer">You can change this setting anytime by clicking the <i class="fas fa-eye-slash"></i> icon in the header</div>
    </div>
  </div>
  
  <!-- Mobile Drawer -->
  <div id="drawerOverlay" class="drawer-overlay" tabindex="-1" aria-hidden="true"></div>
  <nav id="mobileDrawer" class="mobile-drawer" aria-hidden="true" aria-labelledby="mobileMenuToggle">
    <button class="drawer-close" id="drawerClose" aria-label="Close menu">×</button>
    <a href="/">Home</a>
    <div class="drawer-categories-toggle" id="drawerCategoriesToggle">
      <div class="icon-text"><i class="fas fa-th"></i><span>Categories</span></div>
      <i class="fas fa-chevron-down chevron"></i>
    </div>
    <div id="drawerCategoriesSection">
      <div class="drawer-categories-label">MOST POPULAR CATEGORIES</div>
      <div id="drawerCategories"></div>
      <a href="/categories/" class="drawer-view-all-btn">View All Categories</a>
    </div>
  </nav>
  
  <main>
    <section class="hero" aria-labelledby="heroTitle">
      <h1 id="heroTitle">OnlyFans Nearby: Find & Connect With Local Creators</h1>
      <h2>Discover Nearby OnlyFans Talent Today</h2>
    </section>
    <div class="location-box" aria-live="polite">
      <div class="location-box-label">Current Location</div>
      <div class="current-location" id="currentLocation"><i class="fas fa-map-marker-alt"></i><span>Detecting...</span></div>
      <div class="location-actions">
        <button class="btn btn-primary" id="useLocationBtn"><i class="fas fa-location-arrow"></i>Use My Location</button>
        <button class="btn btn-outline" id="changeLocationBtn"><i class="fas fa-globe"></i>Change Location</button>
      </div>
      <div id="locationStatus" class="loading-inline" style="display:none;"></div>
    </div>
    <section id="nearbyResults" class="results-section">
      <div class="results-header" id="resultsHeader" style="display:none;">
        <h2>Creators Near You</h2>
        <p id="resultsLocation">Showing results in <strong id="resultsLocationName"></strong></p>
      </div>
      <div class="results-placeholder" id="resultsPlaceholder">Select or detect a location to load nearby creators.</div>
      <div id="resultsContainer" class="row g-3 justify-content-center"></div>
      <div class="load-more-wrapper" style="display:none;" id="loadMoreWrapper">
        <button class="load-more-btn" id="loadMoreBtn">Load More</button>
      </div>
    </section>
  </main>

  <!-- Country selection modal -->
  <div class="modal-overlay" id="countryModal" aria-hidden="true" role="dialog" aria-labelledby="countryModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h3 id="countryModalTitle">Select Your Location</h3>
        <p>Choose location to find models nearby</p>
        <button class="modal-close" id="countryModalClose" aria-label="Close">×</button>
      </div>
      <div class="country-search-wrapper">
        <input type="text" id="countrySearch" class="country-search" placeholder="Search country..." aria-label="Search country" autocomplete="off" />
      </div>
      <ol class="country-list" id="countryList" role="listbox" aria-label="Country list"></ol>
    </div>
  </div>

  <script type="module">
    // Import categories for dropdowns
    import { popularCategories, categoryToSlug } from '/config/categories.js?v=20251121-4';
    
    // Populate desktop categories dropdown
    const catMenuEl = document.getElementById('categoriesMenu');
    if (catMenuEl && popularCategories) {
      const menuHTML = popularCategories.map(cat => 
        `<a href="/categories/${categoryToSlug(cat)}/">${cat}</a>`
      ).join('') + '<div class="divider"></div><a href="/categories/" class="view-all">View All Categories</a>';
      catMenuEl.innerHTML = menuHTML;
    }
    
    // Populate mobile drawer categories
    const drawerCategories = document.getElementById('drawerCategories');
    if (drawerCategories && popularCategories) {
      const drawerHTML = popularCategories.map(cat => 
        `<a href="/categories/${categoryToSlug(cat)}/">${cat}</a>`
      ).join('');
      drawerCategories.innerHTML = drawerHTML;
    }
    
    // Mobile drawer categories toggle
    const drawerCategoriesToggle = document.getElementById('drawerCategoriesToggle');
    const drawerCategoriesSection = document.getElementById('drawerCategoriesSection');
    if (drawerCategoriesToggle && drawerCategoriesSection) {
      drawerCategoriesToggle.addEventListener('click', () => {
        drawerCategoriesToggle.classList.toggle('open');
        drawerCategoriesSection.classList.toggle('open');
      });
    }
    
    // ============================================
    // HOMEPAGE HEADER FUNCTIONALITY
    // ============================================
    
    // Dark mode toggle
    const themeToggle = document.getElementById('themeToggle');
    function getCurrentTheme() {
      const savedTheme = localStorage.getItem('theme');
      return savedTheme || 'light';
    }
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      const icon = themeToggle.querySelector('i');
      if (theme === 'dark') {
        icon.className = 'fas fa-sun';
        themeToggle.setAttribute('aria-label', 'Switch to light mode');
      } else {
        icon.className = 'fas fa-moon';
        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
      }
    }
    function toggleTheme() {
      const currentTheme = getCurrentTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', newTheme);
      applyTheme(newTheme);
    }
    applyTheme(getCurrentTheme());
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Language toggle functionality
    window.toggleLanguage = function toggleLanguage() {
      // Get current language based on URL
      const isSpanish = location.pathname.startsWith('/es/');
      const newLang = isSpanish ? 'en' : 'es';
      
      if (newLang === 'es') {
        // Redirect to Spanish version: add /es/ prefix
        const esPath = '/es' + location.pathname + location.search;
        location.href = esPath;
      } else {
        // Redirect to English version: remove /es/ prefix
        const enPath = (location.pathname.replace(/^\/es/, '') || '/') + location.search;
        location.href = enPath;
      }
    };

    function updateLanguageIndicator(lang) {
      const indicator = document.getElementById('langIndicator');
      if (indicator) {
        indicator.textContent = lang === 'es' ? 'ES' : 'EN';
      }
    }
    
    // Initialize language indicator on page load
    document.addEventListener('DOMContentLoaded', function() {
      const isSpanish = location.pathname.startsWith('/es/');
      updateLanguageIndicator(isSpanish ? 'es' : 'en');
    });
    
    // Safe Search functionality
    const safeSearchToggle = document.getElementById('safeSearchToggle');
    const safeSearchModal = document.getElementById('safeSearchModal');
    const enableSafeSearchBtn = document.getElementById('enableSafeSearch');
    const dismissSafeSearchBtn = document.getElementById('dismissSafeSearch');
    function getSafeSearchState() { const saved = localStorage.getItem('safeSearch'); return saved === 'true'; }
    function hasSeenSafeSearchModal() { return localStorage.getItem('safeSearchModalShown') === 'true'; }
    function applySafeSearch(enabled) {
      if (enabled) {
        document.body.classList.add('safe-search-active');
        safeSearchToggle.classList.add('active');
        safeSearchToggle.querySelector('i').className = 'fas fa-eye-slash';
      } else {
        document.body.classList.remove('safe-search-active');
        safeSearchToggle.classList.remove('active');
        safeSearchToggle.querySelector('i').className = 'fas fa-eye';
      }
      localStorage.setItem('safeSearch', enabled.toString());
    }
    function toggleSafeSearch() { applySafeSearch(!getSafeSearchState()); }
    function showSafeSearchModal() {
      if (safeSearchModal) {
        safeSearchModal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
    }
    function hideSafeSearchModal() {
      if (safeSearchModal) {
        safeSearchModal.classList.remove('show');
        document.body.style.overflow = '';
        localStorage.setItem('safeSearchModalShown', 'true');
      }
    }
    function initSafeSearch() {
      applySafeSearch(getSafeSearchState());
      if (!hasSeenSafeSearchModal()) {
        setTimeout(showSafeSearchModal, 10000);
      }
    }
    if (safeSearchToggle) safeSearchToggle.addEventListener('click', toggleSafeSearch);
    if (enableSafeSearchBtn) enableSafeSearchBtn.addEventListener('click', () => { applySafeSearch(true); hideSafeSearchModal(); });
    if (dismissSafeSearchBtn) dismissSafeSearchBtn.addEventListener('click', () => { applySafeSearch(false); hideSafeSearchModal(); });
    if (safeSearchModal) {
      safeSearchModal.addEventListener('click', (e) => {
        if (e.target === safeSearchModal) { applySafeSearch(false); hideSafeSearchModal(); }
      });
    }
    document.addEventListener('keydown', (e) => {
      if (e.altKey && e.key.toLowerCase() === 's') { e.preventDefault(); toggleSafeSearch(); }
      if (e.key === 'Escape' && safeSearchModal && safeSearchModal.classList.contains('show')) {
        applySafeSearch(false); hideSafeSearchModal();
      }
    });
    initSafeSearch();
    
    // Mobile Search Modal
    const mobileSearchModal = document.getElementById('mobileSearchModal');
    const mobileSearchTrigger = document.getElementById('mobileSearchTrigger');
    const mobileSearchBack = document.getElementById('mobileSearchBack');
    const mobileSearchInput = document.getElementById('mobileSearchInput');
    const mobileSearchSuggestions = document.getElementById('mobileSearchSuggestions');
    const popularSearches = ['milf', 'asian', 'big tits', 'trans', 'mature', 'latina', 'big ass', 'bbw'];
    function populateMobileSuggestions() {
      if (mobileSearchSuggestions) {
        const suggestionsHTML = popularSearches.map(term => 
          `<a href="/?q=${encodeURIComponent(term)}" class="mobile-search-suggestion"><i class="fas fa-fire"></i><span>${term}</span></a>`
        ).join('');
        mobileSearchSuggestions.innerHTML = suggestionsHTML;
      }
    }
    function openMobileSearch() {
      if (mobileSearchModal) {
        mobileSearchModal.classList.add('active');
        document.body.style.overflow = 'hidden';
        setTimeout(() => { if (mobileSearchInput) mobileSearchInput.focus(); }, 100);
      }
    }
    function closeMobileSearch() {
      if (mobileSearchModal) {
        mobileSearchModal.classList.remove('active');
        document.body.style.overflow = '';
        if (mobileSearchInput) mobileSearchInput.value = '';
      }
    }
    if (mobileSearchTrigger) mobileSearchTrigger.addEventListener('click', openMobileSearch);
    if (mobileSearchBack) mobileSearchBack.addEventListener('click', closeMobileSearch);
    if (mobileSearchInput) {
      mobileSearchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const query = mobileSearchInput.value.trim();
          if (query) window.location.href = `/?q=${encodeURIComponent(query)}`;
        }
      });
    }
    populateMobileSuggestions();
    
    // Header scroll effect
    window.addEventListener('scroll', () => {
      const header = document.getElementById('mainHeader');
      if (header) {
        if (window.pageYOffset > 50) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
      }
    });
    
    // Desktop Categories dropdown
    const catToggle = document.getElementById('categoriesToggle');
    // catMenuEl already declared above for population
    if (catToggle && catMenuEl) {
      catToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = catMenuEl.classList.toggle('open');
        catToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        catMenuEl.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
      });
      document.addEventListener('click', (e) => {
        if (!catMenuEl.classList.contains('open')) return;
        if (!catMenuEl.contains(e.target) && e.target !== catToggle) {
          catMenuEl.classList.remove('open');
          catToggle.setAttribute('aria-expanded', 'false');
          catMenuEl.setAttribute('aria-hidden', 'true');
        }
      });
    }
    
    // Mobile drawer
    const mobileToggle = document.getElementById('mobileMenuToggle');
    const drawer = document.getElementById('mobileDrawer');
    const overlay = document.getElementById('drawerOverlay');
    const drawerClose = document.getElementById('drawerClose');
    function openDrawer(){
      if (!drawer || !overlay) return;
      drawer.classList.add('open'); overlay.classList.add('open');
      drawer.setAttribute('aria-hidden','false'); overlay.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeDrawer(){
      if (!drawer || !overlay) return;
      drawer.classList.remove('open'); overlay.classList.remove('open');
      drawer.setAttribute('aria-hidden','true'); overlay.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }
    if (mobileToggle) mobileToggle.addEventListener('click', (e)=>{ e.preventDefault(); openDrawer(); });
    if (overlay) overlay.addEventListener('click', closeDrawer);
    if (drawerClose) drawerClose.addEventListener('click', closeDrawer);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeDrawer(); });
    
    // Header search redirect to homepage
    const headerSearch = document.getElementById('headerSearch');
    if (headerSearch) {
      headerSearch.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const query = headerSearch.value.trim();
          if (query) window.location.href = `/?q=${encodeURIComponent(query)}`;
        }
      });
    }
    
    // ============================================
    // NEAR-ME PAGE LOGIC
    // ============================================
    
    // Country data (Tier-1 prioritized at top)
    const tier1 = [
      ['US','United States'],['GB','United Kingdom'],['CA','Canada'],['AU','Australia'],['DE','Germany'],['FR','France'],['IT','Italy'],['ES','Spain'],['NL','Netherlands'],['SE','Sweden'],['NO','Norway'],['DK','Denmark'],['CH','Switzerland'],['AT','Austria'],['BE','Belgium'],['IE','Ireland'],['NZ','New Zealand']
    ];
    const restCountries = [
      ['AR','Argentina'],['BG','Bulgaria'],['BR','Brazil'],['CL','Chile'],['CN','China'],['CO','Colombia'],['CZ','Czech Republic'],['EE','Estonia'],['FI','Finland'],['GR','Greece'],['HK','Hong Kong'],['HU','Hungary'],['IN','India'],['JP','Japan'],['KR','South Korea'],['LT','Lithuania'],['LV','Latvia'],['MX','Mexico'],['MY','Malaysia'],['PH','Philippines'],['PL','Poland'],['PT','Portugal'],['RO','Romania'],['RU','Russia'],['SG','Singapore'],['SK','Slovakia'],['SI','Slovenia'],['TH','Thailand'],['TR','Turkey'],['UA','Ukraine'],['ZA','South Africa']
    ];
    const countries = [...tier1, ...restCountries];

    const els = {
      currentLocation: document.getElementById('currentLocation'),
      useLocationBtn: document.getElementById('useLocationBtn'),
      changeLocationBtn: document.getElementById('changeLocationBtn'),
      locationStatus: document.getElementById('locationStatus'),
      resultsPlaceholder: document.getElementById('resultsPlaceholder'),
      resultsContainer: document.getElementById('resultsContainer'),
      countryModal: document.getElementById('countryModal'),
      countryModalClose: document.getElementById('countryModalClose'),
      countryList: document.getElementById('countryList'),
      countrySearch: document.getElementById('countrySearch')
    };

    function renderCountryList(filter='') {
      els.countryList.innerHTML = '';
      const normalized = filter.trim().toLowerCase();
      const subset = countries.filter(([code,name]) => !normalized || name.toLowerCase().includes(normalized) || code.toLowerCase().includes(normalized));
      subset.forEach(([code,name], idx) => {
        const li = document.createElement('li');
        li.className = 'country-item';
        li.setAttribute('role','option');
        li.dataset.code = code;
        li.innerHTML = `<span class="country-code">${code}</span><span>${name}</span>`;
        li.addEventListener('click', () => {
          saveLocation({ countryCode: code, countryName: name });
          closeCountryModal();
        });
        els.countryList.appendChild(li);
      });
    }

    function openCountryModal() {
      els.countryModal.classList.add('open');
      els.countryModal.setAttribute('aria-hidden','false');
      renderCountryList();
      els.countrySearch.value='';
      els.countrySearch.focus();
    }
    function closeCountryModal() {
      els.countryModal.classList.remove('open');
      els.countryModal.setAttribute('aria-hidden','true');
    }

    els.countryModalClose.addEventListener('click', closeCountryModal);
    els.changeLocationBtn.addEventListener('click', openCountryModal);
    els.countrySearch.addEventListener('input', (e)=> renderCountryList(e.target.value));

    function saveLocation(loc) {
      localStorage.setItem('nearMeLocation', JSON.stringify(loc));
      updateCurrentLocationDisplay(loc);
      resetPagination();
      fetchNearby(loc, false);
    }

    function updateCurrentLocationDisplay(loc) {
      const span = els.currentLocation.querySelector('span');
      span.textContent = loc.city ? `${loc.city}, ${loc.countryName}` : loc.countryName;
    }

    // Favorites helpers
    function getFavoritesSet(){
      try { const raw = localStorage.getItem('favorites'); if(!raw) return new Set(); return new Set(JSON.parse(raw)); } catch { return new Set(); }
    }
    function persistFavorites(set){ localStorage.setItem('favorites', JSON.stringify(Array.from(set))); }
    function toggleFavorite(username, btn){
      const set = getFavoritesSet();
      if(set.has(username)){ set.delete(username); btn.classList.remove('active'); btn.querySelector('span').textContent='♡'; }
      else { set.add(username); btn.classList.add('active'); btn.querySelector('span').textContent='♥'; }
      persistFavorites(set);
      try { if (window.fpUpdateWishlistBadge) window.fpUpdateWishlistBadge(); } catch {}
    }
    // Expose for inline handlers and cross-script usage
    window.getFavoritesSet = getFavoritesSet;
    window.persistFavorites = persistFavorites;
    window.toggleFavorite = toggleFavorite;

    // Note: We rely on inline onclick on the button (same as homepage)

    // Responsive image sources
    function buildResponsiveSources(originalUrl){
      if(!originalUrl) return { src:'/static/no-image.png', srcset:'', sizes:'(max-width:600px) 50vw, 25vw' };
      const widths=[144,240,320,480,720];
      const safeUrl=(u)=>u.startsWith('http')?u:'/static/no-image.png';
      const srcset=widths.map(w=>`${proxyImg(safeUrl(originalUrl),w,Math.round(w*4/3))} ${w}w`).join(', ');
      const src=proxyImg(safeUrl(originalUrl),320,Math.round(320*4/3));
      const sizes='(max-width: 480px) 144px, (max-width: 768px) 240px, 320px';
      return { src, srcset, sizes };
    }
    function proxyImg(url,w,h){
      try { const enc=encodeURIComponent(url); return `https://images.weserv.nl/?url=${enc}&w=${w}&h=${h}&fit=cover&we`; } catch { return '/static/no-image.png'; }
    }

    let currentPage=1, pageSize=40, isLoading=false, hasMore=false, activeLocation=null;
    function resetPagination(){ currentPage=1; hasMore=false; }
    function updateLoadMore(){ const wrap=document.getElementById('loadMoreWrapper'); if(hasMore){ wrap.style.display='block'; } else { wrap.style.display='none'; } const btn=document.getElementById('loadMoreBtn'); btn.disabled=isLoading; }

    async function fetchNearby(loc, append){
      activeLocation=loc;
      if(isLoading) return;
      isLoading=true; updateLoadMore();
      if(!append){ els.resultsContainer.innerHTML=''; }
      els.resultsPlaceholder.style.display='block';
      els.resultsPlaceholder.innerHTML = `<div class='loading-inline'><div class='spinner'></div>Searching creators near <strong>${loc.countryName}</strong>...</div>`;
      // Build query using city + country words (avoid long phrases)
      const terms=[]; if(loc.city) terms.push(loc.city); if(loc.countryName) terms.push(loc.countryName);
      const q=terms.map(t=>t.split(/\s+/).slice(0,2).join(' ')).join('|');
      const apiUrl=`/api/search?q=${encodeURIComponent(q)}&page=${currentPage}&page_size=${pageSize}`;
      let data=[]; let ok=false;
      try { const resp=await fetch(apiUrl); ok=resp.ok; data=await resp.json(); } catch(e){ console.error(e); }
      if(!ok || !Array.isArray(data) || data.length===0){
        els.resultsPlaceholder.innerHTML=`No direct matches for <strong>${loc.countryName}</strong>. Showing popular creators.`;
        // Fallback query: verified popular (use a generic term to fetch variety)
        try { const resp=await fetch(`/api/search?q=hot&page=1&page_size=${pageSize}`); if(resp.ok){ data=await resp.json(); } } catch {}
      }
      if(!Array.isArray(data)) data=[];
      if(data.length===0){ els.resultsPlaceholder.innerHTML=`No results found.`; isLoading=false; updateLoadMore(); return; }
      // Show results header with location
      const resultsHeader = document.getElementById('resultsHeader');
      const resultsLocationName = document.getElementById('resultsLocationName');
      if(resultsHeader && resultsLocationName) {
        const displayLoc = loc.city ? `${loc.city}, ${loc.countryName}` : loc.countryName;
        resultsLocationName.textContent = displayLoc;
        resultsHeader.style.display = 'block';
      }
      // Render
      data.forEach((item, idx) => {
        const img = item.avatar || item.avatar_c144 || "";
        const imgSrc = img && img.startsWith("http") ? img : "/static/no-image.png";
        const responsive = buildResponsiveSources(imgSrc);
        const name = item.name || "Unknown";
        const username = item.username || "—";
        const priceText = (item.subscribePrice && !isNaN(item.subscribePrice)) ? `$${parseFloat(item.subscribePrice).toFixed(2)}` : "FREE";
        const verifiedIcon = item.isVerified ? "✅ " : "";
        const bio = item.about || "";
        const profileUrl = username !== "—" ? `https://onlyfans.com/${encodeURIComponent(username)}` : "#";
        const favSet = getFavoritesSet();
        const favActive = username !== "—" && favSet.has(username);
        const favChar = favActive ? '♥' : '♡';
        const isFirstCard = els.resultsContainer.children.length === 0 && currentPage === 1;
        if (isFirstCard) {
          try {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = responsive.src;
            link.setAttribute('imagesrcset', responsive.srcset);
            link.setAttribute('imagesizes', responsive.sizes);
            document.head.appendChild(link);
          } catch {}
        }
        const col = document.createElement("div");
        col.className = "col-sm-6 col-md-4 col-lg-3 mb-4";
        const safeUsername = String(username).replace(/'/g, "\\'");
        col.innerHTML = `
          <div class="card h-100">
            <button class="favorite-btn ${favActive ? 'active' : ''}" data-username="${safeUsername}" type="button" onclick="event.preventDefault(); toggleFavorite('${safeUsername}', this);">
              <span>${favChar}</span>
            </button>
            <img src="${responsive.src}" 
                 srcset="${responsive.srcset}"
                 sizes="${responsive.sizes}"
                 alt="${name}" 
                 width="270" 
                 height="360"
                 style="aspect-ratio: 3 / 4;"
                 ${isFirstCard ? 'loading="eager" fetchpriority="high"' : 'loading="lazy" fetchpriority="low"'} decoding="async"
                 referrerpolicy="no-referrer" 
                 onerror="if(this.src!='/static/no-image.png'){this.removeAttribute('srcset'); this.removeAttribute('sizes'); this.src='${imgSrc}';}"
                 onload="if(this.naturalWidth<=10||this.naturalHeight<=10){this.parentElement.parentElement.remove();}">
            <div class="card-body">
              <h5>${verifiedIcon}${name}</h5>
              <p class="username">@${username}</p>
              ${priceText === "FREE" 
                ? `<p class="price-free">${priceText}</p>` 
                : `<p class="price-tag">${priceText}</p>`}
              <a href="${profileUrl}" class="view-profile-btn" target="_blank" rel="noopener noreferrer">
                View Profile
              </a>
            </div>
          </div>`;
        els.resultsContainer.appendChild(col);
      });
      els.resultsPlaceholder.style.display='none';
      hasMore=data.length===pageSize; currentPage++; isLoading=false; updateLoadMore();
    }

    document.getElementById('loadMoreBtn').addEventListener('click', ()=>{ if(activeLocation) fetchNearby(activeLocation, true); });

    async function detectLocation() {
      els.locationStatus.style.display='inline-flex';
      els.locationStatus.innerHTML = `<div class='spinner'></div><span>Detecting location...</span>`;
      try {
        // Try precise geolocation first
        const geo = await new Promise((resolve,reject)=> {
          if(!('geolocation' in navigator)) return reject(new Error('geolocation unsupported'));
          navigator.geolocation.getCurrentPosition(resolve, reject, { timeout:8000 });
        });
        const { latitude, longitude } = geo.coords;
        const reverse = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=jsonv2`).then(r=>r.json());
        const countryName = reverse.address?.country || 'Unknown';
        const city = reverse.address?.city || reverse.address?.town || reverse.address?.village || reverse.address?.state || '';
        const countryCode = reverse.address?.country_code?.toUpperCase() || '';
        const loc = { countryCode, countryName, city };
        saveLocation(loc);
        els.locationStatus.style.display='none';
      } catch (err) {
        // Fallback: IP-based
        try {
          const ipData = await fetch('https://ipapi.co/json').then(r=>r.json());
          const loc = { countryCode: ipData.country, countryName: ipData.country_name, city: ipData.city };
          saveLocation(loc);
        } catch (e2) {
          updateCurrentLocationDisplay({ countryName: 'Location Unavailable' });
        } finally {
          els.locationStatus.style.display='none';
        }
      }
    }

    els.useLocationBtn.addEventListener('click', detectLocation);

    // Load saved location if exists
    const saved = localStorage.getItem('nearMeLocation');
    if (saved) {
      try { updateCurrentLocationDisplay(JSON.parse(saved)); } catch {}
    } else {
      // attempt passive detection via IP quickly (non-blocking)
      fetch('https://ipapi.co/json').then(r=>r.json()).then(d=>{
        const loc = { countryCode:d.country, countryName:d.country_name, city:d.city };
        updateCurrentLocationDisplay(loc);
      }).catch(()=>{});
    }
  </script>
  
  <!-- Sticky Bottom Navigation -->
  <nav class="sticky-bottom-nav" role="navigation" aria-label="Bottom navigation">
    <a href="#headerSearch" class="nav-item" data-nav="search">
      <span class="icon"><i class="fa-solid fa-magnifying-glass"></i></span>
      <span class="label">Search</span>
    </a>
    <a href="/near-me/" class="nav-item" data-nav="near">
      <span class="icon"><i class="fa-solid fa-location-arrow"></i></span>
      <span class="label">Near Me</span>
    </a>
    <a href="/?sort=best" class="nav-item" data-nav="best">
      <span class="icon"><i class="fa-solid fa-trophy"></i></span>
      <span class="label">Best</span>
    </a>
    <a href="/?sort=hot" class="nav-item" data-nav="hot">
      <span class="icon"><i class="fa-solid fa-fire"></i></span>
      <span class="label">Hot!</span>
    </a>
    <a href="/wishlist/" class="nav-item" data-nav="wishlist">
      <span class="icon position-relative"><i class="fa-solid fa-heart"></i><span class="wishlist-count" style="display:none;position:absolute;top:-6px;right:-6px;background:#ff3b30;color:#fff;font-size:10px;font-weight:700;border-radius:10px;min-width:18px;height:18px;align-items:center;justify-content:center;padding:0 5px;border:2px solid var(--bg-secondary);box-shadow:0 2px 8px rgba(255,59,48,0.4)">0</span></span>
      <span class="label">Wishlist</span>
    </a>
  </nav>
  <style>
    .sticky-bottom-nav{position:fixed;left:0;right:0;bottom:calc(0px + env(safe-area-inset-bottom));z-index:9999;display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:var(--bg-secondary);border-top:1px solid var(--border-color);border-left:0;border-right:0;border-bottom:0;border-radius:0;box-shadow:0 -4px 12px rgba(0,0,0,0.06)}
    .sticky-bottom-nav .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--text-primary);text-decoration:none}
    .sticky-bottom-nav .icon{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,#00AFF0 0%,#0099D6 100%);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,175,240,0.35);color:#fff;position:relative;transition:box-shadow .35s ease, transform .3s ease}
    .sticky-bottom-nav .nav-item:hover .icon{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,175,240,0.55)}
    .sticky-bottom-nav .nav-item.active .icon{background:linear-gradient(135deg,#0099D6 0%,#0088C0 100%);box-shadow:0 6px 16px rgba(0,175,240,0.55)}
    .sticky-bottom-nav .nav-item.active .icon::after{content:"";position:absolute;inset:0;border-radius:inherit;box-shadow:0 0 0 0 rgba(0,175,240,.55);animation:pulseGlow 3.2s ease-in-out infinite;pointer-events:none}
    @keyframes pulseGlow{0%,65%{box-shadow:0 0 0 0 rgba(0,175,240,.55)}80%{box-shadow:0 0 0 10px rgba(0,175,240,0)}100%{box-shadow:0 0 0 0 rgba(0,175,240,0)}}
    .sticky-bottom-nav .icon i{font-size:15px}
    .sticky-bottom-nav .label{font-size:11px;font-weight:700;color:var(--text-primary)}
  </style>
  <script>
    (function(){try{
      var p=location.pathname;
      document.querySelectorAll('.sticky-bottom-nav .nav-item').forEach(function(a){
        var k=a.getAttribute('data-nav');
        if((k==='near' && (p.indexOf('/near-me')===0))){a.classList.add('active');}
      });
      var searchLink=document.querySelector('.sticky-bottom-nav .nav-item[data-nav="search"]');
      if(searchLink){
        searchLink.addEventListener('click',function(ev){
          ev.preventDefault();
          try{
            var isMobile=window.matchMedia('(max-width: 768px)').matches;
            var headerInput=document.getElementById('headerSearch')||document.querySelector('.header-search-input');
            var headerVisible=headerInput && headerInput.offsetParent!==null;
            if(isMobile && !headerVisible){
              var mobileTrigger=document.getElementById('mobileSearchTrigger');
              if(mobileTrigger){mobileTrigger.click();return;}
            }
            window.scrollTo({top:0,behavior:'smooth'});
            if(headerInput && headerVisible){
              setTimeout(function(){headerInput.focus({preventScroll:true});},220);
            }else if(!isMobile){
              location.href='/';
            }
          }catch(err){location.href='/';}
        });
      }
    }catch(e){}})();
  </script>
  <script src="/utils/wishlist-badge.js?v=20251116-1"></script>
</body>
</html>
